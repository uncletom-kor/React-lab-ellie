import React, { memo, useCallback, useMemo, useReducer } from 'react';
import personReducer from './reducer/PersonReducer';

export default function AppMentorsButton() {
    const [person, dispatch] = useReducer(personReducer, initialPerson);

    // useCallback í•¨ìˆ˜ì˜ ì‚¬ìš©
    // useCallbackì€ Reactì˜ í›…(hook) ì¤‘ í•˜ë‚˜ë¡œ, 
    // ì°¸ì¡°ê°€ ë³€ê²½ë˜ì§€ ì•ŠëŠ” ì½œë°± í•¨ìˆ˜ë¥¼ ìƒì„±í•˜ëŠ” ë° ì‚¬ìš© ë¨.
    // ì½œë°± í•¨ìˆ˜ëŠ” ì»´í¬ë„ŒíŠ¸ì—ì„œ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ë‚˜ íƒ€ì´ë¨¸ ë“±ì— ì‚¬ìš©ë˜ë©° 
    // ì¼ë°˜ì ìœ¼ë¡œ ì½œë°± í•¨ìˆ˜ëŠ” ì»´í¬ë„ŒíŠ¸ê°€ ë¦¬ë Œë”ë§ë  ë•Œë§ˆë‹¤ ìƒˆë¡œ ìƒì„±ëœë‹¤. 
    // í•˜ì§€ë§Œ useCallbackì„ ì‚¬ìš©í•˜ë©´ ì½œë°± í•¨ìˆ˜ê°€ ë³€ê²½ë˜ì§€ ì•ŠëŠ” ê²½ìš°ì—ëŠ” 
    // ìƒˆë¡œ ìƒì„±ë˜ì§€ ì•Šê³  ì¬ì‚¬ìš©ëœë‹¤.
    // useCallbackì˜ ì²« ë²ˆì§¸ ì¸ìëŠ” ì½œë°± í•¨ìˆ˜ì´ë©° ì´ í•¨ìˆ˜ëŠ” ì¸ìë¥¼ ë°›ì§€ ì•Šì„ ìˆ˜ë„ ìˆê³ , 
    // ì—¬ëŸ¬ ê°œì˜ ì¸ìë¥¼ ë°›ì„ ìˆ˜ë„ ìˆë‹¤.
    // ë‘ ë²ˆì§¸ ì¸ìëŠ” deps ë°°ì—´ì´ê³  deps ë°°ì—´ì— ìˆëŠ” ê°’ì´ ë³€ê²½ë  ë•Œë§ˆë‹¤ 
    // ì½œë°± í•¨ìˆ˜ê°€ ìƒˆë¡œ ìƒì„±ëœë‹¤. 
    // deps ë°°ì—´ì„ ë¹ˆ ë°°ì—´([])ë¡œ ì„¤ì •í•˜ë©´ ì½œë°± í•¨ìˆ˜ëŠ” 
    // ì»´í¬ë„ŒíŠ¸ê°€ ì²˜ìŒ ë§ˆìš´íŠ¸ë  ë•Œ í•œ ë²ˆë§Œ ìƒì„±ë˜ê³ , ì´í›„ì—ëŠ” ë³€ê²½ë˜ì§€ ì•ŠëŠ”ë‹¤.
    // ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ë¡œ ì‚¬ìš©ë  ë•ŒëŠ” ì„±ëŠ¥ í–¥ìƒì„ ìœ„í•´ useCallbackì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤. 
    // ì´ë ‡ê²Œ í•˜ë©´ ì»´í¬ë„ŒíŠ¸ê°€ ë¦¬ë Œë”ë§ë  ë•Œë§ˆë‹¤ 
    // ì½œë°± í•¨ìˆ˜ê°€ ìƒˆë¡œ ìƒì„±ë˜ëŠ” ê²ƒì„ ë°©ì§€í•  ìˆ˜ ìˆë‹¤.

    // ì•„ë˜ì˜ ì½”ë“œì—ì„œëŠ” 'handleUpdate'ë¼ëŠ” ì½œë°± í•¨ìˆ˜ë¥¼ ìƒì„±í•˜ê³ , 
    // useCallbackì„ ì‚¬ìš©í•˜ì—¬ deps ë°°ì—´ì„ ë¹ˆ ë°°ì—´ë¡œ ì„¤ì •í–ˆë‹¤. 
    // ì´ë ‡ê²Œ í•˜ë©´ 'handleUpdate' í•¨ìˆ˜ëŠ” ì»´í¬ë„ŒíŠ¸ê°€ ì²˜ìŒ ë§ˆìš´íŠ¸ë  ë•Œ í•œ ë²ˆë§Œ ìƒì„±ë˜ê³ , 
    // ì´í›„ì—ëŠ” ë³€ê²½ë˜ì§€ ì•ŠëŠ”ë‹¤.
    const handleUpdate = useCallback(() => {
        const prev = prompt(`ëˆ„êµ¬ì˜ ì´ë¦„ì„ ë°”ê¾¸ê³  ì‹¶ì€ê°€ìš”?`);
        const current = prompt(`ì´ë¦„ì„ ë¬´ì—‡ìœ¼ë¡œ ë°”ê¾¸ê³  ì‹¶ì€ê°€ìš”?`);
        dispatch({ type: 'updated', prev, current });
    }, []);

    const handleAdd = useCallback(() => {
        const name = prompt(`ë©˜í† ì˜ ì´ë¦„ì€?`);
        const title = prompt(`ë©˜í† ì˜ ì§í•¨ì€?`);
        dispatch({ type: 'added', name, title });
    }, []);

    const handleDelete = useCallback(() => {
        const name = prompt(`ëˆ„êµ¬ë¥¼ ì‚­ì œí•˜ê³  ì‹¶ì€ê°€ìš”?`);
        dispatch({ type: 'deleted', name });
    }, []);

    return (
        <div>
            <h1>
                {person.name}ëŠ” {person.title}
            </h1>
            <p>{person.name}ì˜ ë©˜í† ëŠ”:</p>
            <ul>
                {person.mentors.map((mentor, index) => (
                    <li key={index}>
                        {mentor.name} ({mentor.title})
                    </li>
                ))}
            </ul>
            <Button
                text="ë©˜í†  ì´ë¦„ ë°”ê¾¸ê¸°"
                onClick={handleUpdate}
            />
            <Button
                text="ì‚­ì œí•˜ê¸°"
                onClick={handleDelete}
            />
            <Button
                text="ë©˜í†  ì¶”ê°€í•˜ê¸°"
                onClick={handleAdd}
            />
        </div>
    );
}


// memoëŠ” Reactì˜ í›…(hook) API ì¤‘ í•˜ë‚˜ë¡œ, ì»´í¬ë„ŒíŠ¸ì˜ ì„±ëŠ¥ì„ í–¥ìƒ ì‹œí‚¤ëŠ” ë° ì‚¬ìš©ëœë‹¤.
// ì»´í¬ë„ŒíŠ¸ê°€ ë¦¬ë Œë”ë§ ë  ë•Œë§ˆë‹¤ render í•¨ìˆ˜ê°€ í˜¸ì¶œëœë‹¤. 
// í•˜ì§€ë§Œ render í•¨ìˆ˜ì—ì„œ ë°˜í™˜í•˜ëŠ” ê²°ê³¼ê°€ ì´ì „ê³¼ ë™ì¼í•œ ê²½ìš°ì—ëŠ” 
// ì»´í¬ë„ŒíŠ¸ê°€ ë‹¤ì‹œ ëœë”ë§í•˜ì§€ ì•Šì•„ì•¼ í•©ë‹ˆë‹¤.

// memoëŠ” render í•¨ìˆ˜ì˜ ê²°ê³¼ë¥¼ ìºì‹œí•˜ê³ , ì´ì „ ê²°ê³¼ì™€ ë¹„êµí•˜ì—¬ 
// ë™ì¼í•œ ê²½ìš°ì—ëŠ” ì»´í¬ë„ŒíŠ¸ë¥¼ ë‹¤ì‹œ ê·¸ë¦¬ì§€ ì•ŠëŠ”ë‹¤. 
// ì´ë ‡ê²Œ í•˜ë©´ ë¶ˆí•„ìš”í•œ ë¦¬ë Œë”ë§ì„ ë°©ì§€í•˜ì—¬ ì„±ëŠ¥ì„ í–¥ìƒ ì‹œí‚¬ ìˆ˜ ìˆë‹¤.

// ì•„ë˜ì˜ ì½”ë“œì—ì„œëŠ” Button ì»´í¬ë„ŒíŠ¸ì—ì„œ memoë¥¼ ì‚¬ìš©í•˜ê³  ìˆë‹¤. 
// memoë¥¼ ì‚¬ìš©í•˜ë©´ Button ì»´í¬ë„ŒíŠ¸ê°€ ë¦¬ë Œë”ë§ ë  ë•Œë§ˆë‹¤ 
// console.logê°€ í˜¸ì¶œë˜ëŠ” ê²ƒì„ ë°©ì§€í•  ìˆ˜ ìˆë‹¤.

// memoë¥¼ ì‚¬ìš©í•  ë•ŒëŠ” useMemoì™€ ë§ˆì°¬ê°€ì§€ë¡œ deps ë°°ì—´ì„ ì§€ì •í•  ìˆ˜ ìˆë‹¤. 
// deps ë°°ì—´ì— ìˆëŠ” ê°’ì´ ë³€ê²½ë˜ë©´ ì»´í¬ë„ŒíŠ¸ê°€ ë‹¤ì‹œ ë¦¬-ëœë”ë§ëœë‹¤. 
// deps ë°°ì—´ì„ ë¹ˆ ë°°ì—´([])ë¡œ ì„¤ì •í•˜ë©´ ì»´í¬ë„ŒíŠ¸ëŠ” í•­ìƒ ë‹¤ì‹œ ê·¸ë ¤ì§„ë‹¤.

const Button = memo(({ text, onClick }) => {
    console.log('Button', text, 're-rendering ğŸ˜œ');

    // useMemoëŠ” Reactì˜ í›…(hook) ì¤‘ í•˜ë‚˜ë¡œ,
    // ê³„ì‚° ë¹„ìš©ì´ ë§ì´ ë“œëŠ” ê°’ì„ ìºì‹œí•˜ê³  ì¬ì‚¬ìš©í•˜ëŠ” ë° ì‚¬ìš© ë¨.
    // ì£¼ë¡œ ìƒíƒœë‚˜ propsì˜ ë³€í™”ì— ë”°ë¼ ìì£¼ ê³„ì‚°ë˜ëŠ” ê°’ì„ ìºì‹œí•˜ëŠ” ë° ì‚¬ìš©ë˜ë©°
    // useMemoë¥¼ ì‚¬ìš©í•˜ë©´ ì»´í¬ë„ŒíŠ¸ê°€ ë¶ˆí•„ìš”í•˜ê²Œ ë¦¬ë Œë”ë§ë˜ëŠ” ê²ƒì„ ë°©ì§€í•  ìˆ˜ ìˆë‹¤.

    // ë‘ ë²ˆì§¸ ì¸ìëŠ” deps ë°°ì—´ì´ë©°,
    // deps ë°°ì—´ì— ìˆëŠ” ê°’ì´ ë³€ê²½ë  ë•Œë§ˆë‹¤ ê³„ì‚° í•¨ìˆ˜ê°€ ë‹¤ì‹œ ì‹¤í–‰ëœë‹¤.
    // deps ë°°ì—´ì„ ë¹ˆ ë°°ì—´([])ë¡œ ì„¤ì •í•˜ë©´ ê³„ì‚° í•¨ìˆ˜ëŠ” ì»´í¬ë„ŒíŠ¸ê°€ ì²˜ìŒ ë§ˆìš´íŠ¸ë  ë•Œ
    // í•œ ë²ˆë§Œ ì‹¤í–‰ëœë‹¤.

    // ì•„ë˜ì˜ ë¬¸ì—ì„œëŠ” useMemoë¥¼ ì‚¬ìš©í•˜ì—¬ calculateSomethingì´ë¼ëŠ” ê³„ì‚° í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•˜ê³ ,
    // ê²°ê³¼ë¥¼ result ë³€ìˆ˜ì— ì €ì¥í•œë‹¤.
    // deps ë°°ì—´ì„ ë¹ˆ ë°°ì—´ë¡œ ì„¤ì •í–ˆê¸° ë•Œë¬¸ì— calculateSomething í•¨ìˆ˜ëŠ”
    // ì»´í¬ë„ŒíŠ¸ê°€ ì²˜ìŒ ë§ˆìš´íŠ¸ë  ë•Œ í•œ ë²ˆë§Œ ì‹¤í–‰ëœë‹¤.
    const result = useMemo(() => calculateSomething(), []);

    return (
        <button
            onClick={onClick}
            style={{
                backgroundColor: 'black',
                color: 'white',
                borderRadius: '20px',
                margin: '0.4rem',
            }}>
            {`${text} ${result}`}
        </button>
    );
});

function calculateSomething() {
    for (let i = 0; i < 10000; i++) {
        console.log('ğŸ˜†');
    }
    return 10;
}

const initialPerson = {
    name: 'ì—˜ë¦¬',
    title: 'ê°œë°œì',
    mentors: [
        {
            name: 'ë°¥',
            title: 'ì‹œë‹ˆì–´ê°œë°œì',
        },
        {
            name: 'ì œì„ìŠ¤',
            title: 'ì‹œë‹ˆì–´ê°œë°œì',
        },
    ],
};
